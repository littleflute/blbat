<!DOCTYPE html>
<html>
  <head>    
  <script src="https://littleflute.github.io/JavaScript/w3.js" ></script>
  <script src="https://littleflute.github.io/JavaScript/blclass.js" ></script>
  </head>
<body>
  <h2>index.html v0.51</h2>
  url: <span id="vleType">vleType</span>  

  <input type="url" id="myURL" value="https://learningenglish.voanews.com/a/study-suggests-people-who-got-covid-19-protected-for-months/5670611.html"  style="border: red 1px solid; width: 100%;"><br>
 
  <span id="d4Parse" style="border: blue 1px solid;">d4Parse</span>
<div id="demo" style="border: red 1px solid;">
  <textarea id="ta" name="w3review" rows="14" cols="150">
  to download ...  
  </textarea>
</div>
<div id="msg" style="border: green 1px solid;">msg</div>

<script>
  var fParsePage =  function (_parentBtn,txt){
    var a = txt.split("<audio src=");
    var d = document.getElementById("msg");
    d.innerHTML = a.length;
    for(i in a){
      if(i==0) continue;
      var b = blo0.blBtn(d,"p"+i,_parentBtn.innerHTML + "_p"+i);
      var d = blo0.blDiv(d,"d"+i,"d"+i,"grey");
      b.onclick = function(_a,_i){
        return function(){
          var a1 = _a[_i].split(" data-fallbacksrc=");
          var a2 = a1[0].split('"');
          download_2_save(a2[1],function(txt){ 
            d.innerHTML = txt; 
        });
        }
      }(a,i);
    }
  }
  var fParseType =  function (_type,txt){
    var d = document.getElementById("d4Parse");
    var a = txt.split('<span class="date date--mb date--size-3" >');
    var date1 = new Date();        
    d.innerHTML = date1.toLocaleTimeString();
    var newData = null;
    var n = 0;
    for(i in a){
      if(i==0) continue;
      var d1 = a[i].split('</span>');
      if(newData!=d1[0]){
        newData=d1[0];
        n = 1;
      }
      else {
        n++;
      }
      var b = blo0.blBtn(d,"b"+i, d1[0] + "_"+_type+n);
      b.style.backgroundColor = "red";
      b.style.color = "white";
      b.onclick = function(_this,_i,_t){
        return function(){
          var a1 = _t.split('href="');
          var a2 = a1[1].split('"');
          var a3 = a2[0];
          var url = "https://learningenglish.voanews.com" + a3;
          document.getElementById("myURL").value = url;
          loadDoc(url,   function(txt){
            document.getElementById("ta").value = txt;
            document.getElementById("msg").innerHTML = url;
            fParsePage(_this,txt);
        });
        }
      }(b,i,a[i]);
    }     
  }
function loadDoc(_url,callBack) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {        
      callBack(this.responseText);
    }
  }; 
  xhttp.open("GET", "http://localhost:3000/geturl?url=" + _url, true);
  xhttp.send();
} 
function download_2_save(_url,callBack) { 
  var xhttp = new XMLHttpRequest(); 
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {        
      callBack(this.responseText);
    }
  }; 
  xhttp.open("GET", "http://localhost:3000/download?url=" + _url , true);
  xhttp.send();
} 


function r(){
  var dvle = document.getElementById("vleType");
  dvle.innerHTML = "v0.22"; 
  var o = {
    "as": 3521,
    "ac": 986,
    "aStories": 1581
  };
  for(i in o){
    var b = blo0.blBtn(dvle,"b"+i,i);  
    b.onclick = function(_o,_i){
      return function(){
        var url = "https://learningenglish.voanews.com/z/";
        url += _o[_i];
        document.getElementById("myURL").value = url;
        loadDoc(url,   function(txt){
          document.getElementById("ta").value = txt;
          document.getElementById("msg").innerHTML = Date();
          fParseType(_i,txt);
        });
      }
    }(o,i);
  }
};
r(); 
</script>


</body>
</html>
